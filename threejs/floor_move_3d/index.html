<!DOCTYPE html>
<html>
<head>
	<title>Fuar AlanÄ±</title>
	<style>
		body {
			overflow: hidden;
			margin: 0;
		}

		.ui {
			position: absolute;
		}

		button{
			margin: 100px;
			height: 200px;
			width: 200px;
		}

		h1{
			font-size: 50px;
		}
	</style>
</head>
<body>

<div style="width:100%;height:250px;text-align: center; color:white;" class="ui">Info header</div>
<button style="top:0"  class="ui" id="move_left"><h1 >Sol</h1></button>
<button style="bottom:0"  class="ui" id="move_forward"><h1 >Ileri</h1></button>
<button style="right:0"  class="ui" id="move_right"><h1 >Sag</h1></button>
<button style="right:0; bottom:0;"  class="ui" id="move_back"><h1 >Geri</h1></button>

	<script src = "three.js"></script>
	<script src = "perlin.js"></script>
	<script src = "PointerLockControls.js"></script>
	<script src = "three/GLTFLoader.js"></script>


	<script src = "components/text.js"></script>
	<script src="components/loadModel.js"></script>


	 <script type="text/javascript">

		 var buttons = document.getElementsByTagName("button");
		 for (let i = 0; i < buttons.length; i++) {
			 buttons[i].addEventListener("click", onButtonClick, false);
		 };

		 function onButtonClick(event) {
			 console.log(event.target.id);

			 let target = event.target.id;

			 switch(target) {
				 case "move_left":
					 controls.moveRight(-1 * movingSpeed)
					 break;
				 case "move_forward":
					 controls.moveForward(movingSpeed)
					 break;
				 case "move_right":
					 controls.moveRight(movingSpeed)
					 break;
				 case "move_back":
					 controls.moveForward(-1 * movingSpeed)
					 break;
				 default:
					 controls.moveForward(movingSpeed)
			 }

		 }



	 	var scene, camera, renderer, controls, hemiLight, spotLight;

 		var scene = new THREE.Scene();
		scene.background = new THREE.Color(0xf0f0f0);
		var renderer = new THREE.WebGLRenderer();
		renderer.setSize(window.innerWidth, window.innerHeight);
		document.body.appendChild(renderer.domElement);
		var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

		camera.position.x = 180;
		camera.position.y = 8;
		camera.position.z = 90;

		//camera.rotation.x -= 50;
		camera.rotation.y -= 250;
		//camera.rotation.z += -50;


		var loader = new THREE.TextureLoader();
		let baseDir = 'texture/parke';
		var materialArray = [

			new THREE.MeshBasicMaterial({map : loader.load(baseDir+"/side4.jpg")}),
			new THREE.MeshBasicMaterial({map : loader.load(baseDir+"/side1.jpg")}),
			new THREE.MeshBasicMaterial({map : loader.load(baseDir+"/top.jpg")}),
			new THREE.MeshBasicMaterial({map : loader.load(baseDir+"/bottom.jpg")}),
			new THREE.MeshBasicMaterial({map : loader.load(baseDir+"/side2.jpg")}),
			new THREE.MeshBasicMaterial({map : loader.load(baseDir+"/side3.jpg")}),

		];

	/*
		var groundBox = new THREE.BoxBufferGeometry(25, 1, 50);
		var groundMesh = new THREE.MeshBasicMaterial({color : 0x00ff00});
		var ground = new THREE.Mesh(groundBox, groundMesh);
		scene.add(ground);
		ground.position.y = -5;

		// Creating the border lines for ground
		var edges = new THREE.EdgesGeometry(groundBox);
		var line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({color : 0x000000}));
		scene.add(line);
		line.position.y = -5;
		*/


		function Block(x,y,z){
			this.x = x;
			this.y = y;
			this.z = z;

			let block;

			this.display = function(){
				var blockBox = new THREE.BoxBufferGeometry(5,5,5); //w, h, d
				//var blockMesh = new THREE.MeshBasicMaterial({color : 0x00ff00});
				block = new THREE.Mesh(blockBox, materialArray);
				scene.add(block);
				block.position.x = this.x;
				block.position.y = this.y;
				block.position.z = this.z;


				// Creating the border lines for ground
				var edges = new THREE.EdgesGeometry(blockBox);
				var line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({color : 0xfffffff}));
				scene.add(line);
				line.position.x = this.x;
				line.position.y = this.y;
				line.position.z = this.z;
			}
		}

		var controls = new THREE.PointerLockControls(camera, document.body);
		document.body.addEventListener("click", function(){
			controls.lock();
		});
		controls.addEventListener("lock", function(){

		});
		controls.addEventListener("unlock", function(){

		});



		add2dText({text:'----'});

		//loadModelFromGLFT({coordinates:{x:0,y:20,z:30},source:'mazda'});


		let rotationBlock = {
			x:0,
			y:-10,
			z:0,
		}

		loadModelFromGLFT(
				{
					coordinates:[
						{x:20,y:3,z:6},
						{x:50,y:3,z:6},
						{x:80,y:3,z:6},
						{x:110,y:3,z:6},
						{x:140,y:3,z:6},

						{x:130,y:3,z:135,rotation:rotationBlock},
						{x:90,y:3,z:135,rotation:rotationBlock},
						{x:50,y:3,z:135,rotation:rotationBlock},
						{x:15,y:3,z:135,rotation:rotationBlock},
					],
					source:'exp4',
					isModelOutDir:false});
		//loadModelFromGLFT({coordinates:{x:250,y:20,z:30},source:'stand_6x3_peninsula'});


		var blocks = [];
		var amplitude = 100
		for(let x = 0 ; x < 31 ; x++){
			for(let z = 0 ; z < 31 ; z++){
				var v = Math.round(noise.perlin2(x,z) * amplitude / 5) * 5;
				blocks.push(new Block(x * 5, v , z * 5));
			}
		}

		blocks.push(new Block(5,5,50));

		for(var i = 0; i < blocks.length; i++){
			blocks[i].display();
		}



		var keys = [];
		var canJump = true;
		document.addEventListener("keydown", function(e){
			keys.push(e.key);
			if(e.key == " " && canJump == true){
				ySpeed = -1.3;
				canJump = false;
			}
		});
		document.addEventListener("keyup", function(e){
			var newArr = [];
			for(var i = 0; i < keys.length; i++){
				if(keys[i] != e.key){
					newArr.push(keys[i]);
				}
			}
			keys = newArr;
		});


		var movingSpeed = 1.5;
		var ySpeed = 0;
		var acc = 0.08;
		var autoJump = false;
		function update(){
			if(keys.includes("w")){
				controls.moveForward(movingSpeed);
				for(var i = 0; i < blocks.length; i++){
						for(var j = 0; j < blocks[i].length; j++){
							if(camera.position.x <= blocks[i][j].x + 2.5 && camera.position.x >= blocks[i][j].x - 2.5 && camera.position.z <= blocks[i][j].z + 2.5 && camera.position.z >= blocks[i][j].z - 2.5){
								if(camera.position.y == blocks[i][j].y - 2.5){
									controls.moveForward(-1 * movingSpeed);
								}
							}
						}
					}
			}
			if(keys.includes("a")){
				controls.moveRight(-1 * movingSpeed);
			}
			if(keys.includes("s")){
				controls.moveForward(-1 * movingSpeed);
			}
			if(keys.includes("d")){
				controls.moveRight(movingSpeed);
			}
		}


		// Resize Window
		window.addEventListener("resize", function(){
			renderer.setSize(window.innerWidth, window.innerHeight);
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
		});

		function render(){
			renderer.render(scene, camera);
		}

		function GameLoop(){
			requestAnimationFrame(GameLoop);
			update();
			render();
		}

		GameLoop();
 	</script>



</body>
</html>
